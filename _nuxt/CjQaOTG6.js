import{g as L,y as R,x as z,k as M,l as p,c as i,a as t,q as m,e as A,m as J,s as k,d as u,v as q,j as e,b as F,w as O,G as H,n as h,F as x,t as V,r as Q,i as W,o as r,E as X,_ as Y}from"./DGvV_olU.js";import{_ as Z}from"./D0SDSYsd.js";import{u as ss}from"./pIvrBe_8.js";const ts={class:"booking-page"},es={class:"container"},os={class:"form-card"},as={class:"form-section"},ls={class:"form-row"},ns={class:"form-group"},is={class:"form-group"},rs={class:"form-row"},ds={class:"form-group"},ps={class:"form-group"},us={class:"form-section"},fs={class:"file-grid"},cs={class:"form-group"},vs={for:"passport_photo",class:"file-label"},ms=["src"],bs={class:"form-group"},ys={for:"voucher_photo",class:"file-label"},_s=["src"],gs={class:"form-group"},ks={for:"national_id_photo",class:"file-label"},hs=["src"],ws={class:"submit-wrapper"},Cs=["disabled"],qs={key:0,class:"bk-modal-overlay"},xs={class:"bk-modal"},Vs={class:"bk-modal-body"},Ss={class:"bk-otp-wrapper"},$s=["onUpdate:modelValue","onInput","onKeydown"],Bs={key:0,class:"bk-modal-error"},Ms={class:"bk-modal-actions"},Fs=["disabled"],Os={key:1,class:"modal-overlay show"},Es={class:"modal"},Is={class:"modal-body success-body"},Ns={class:"tracking-code-display"},Us={class:"success-actions"},Ds=L({__name:"index",setup(Ts){R({title:"حجز بطاقة أغراض شخصية | شركة الرحالة",description:"خدمة حجز بطاقات الأغراض الشخصية للمواطنين عبر شركة الرحالة للصرافة"});const{success:D,error:w}=ss(),E=z().public.apiBase,n=M({name:"",phone:"",national_id:"",payment_type:""}),d=M({passport:null,voucher:null,national_id:null}),l=M({passport:"",voucher:"",national_id:""}),b=p(!1),I=p(""),C=p(!1),v=p(["","","",""]),S=p([]),y=p(""),_=p(!1),N=p(!1),U=p(""),$=(o,s)=>{const f=o.target.files?.[0];if(f){if(f.size>5*1024*1024){w("حجم الصورة يجب أن يكون أقل من 5MB");return}d[s]=f;const a=new FileReader;a.onload=c=>{l[s]=c.target?.result},a.readAsDataURL(f)}},B=o=>{d[o]=null,l[o]="";const s=document.getElementById(`${o}_photo`);s&&(s.value="")},T=async()=>{if(!d.passport||!d.voucher||!d.national_id){w("يرجى رفع جميع الصور المطلوبة");return}b.value=!0;try{const o=new FormData;o.append("name",n.name),o.append("phone",n.phone),o.append("national_id",n.national_id),o.append("payment_type",n.payment_type.toString()),o.append("passport_photo",d.passport),o.append("voucher_photo",d.voucher),o.append("national_id_photo",d.national_id);const s=await $fetch(`${E}/booking-cards/store`,{method:"POST",body:o});s.success&&(I.value=s.token,C.value=!0)}catch(o){if(console.error("Step 1 failed:",o.data||o),o.data?.errors){const s=Object.values(o.data.errors).flat().join(`
`);w(s)}else w(o.data?.message||"حدث خطأ أثناء إرسال البيانات")}finally{b.value=!1}},j=o=>{v.value[o]&&o<3&&S.value[o+1]?.focus()},P=(o,s)=>{!v.value[o]&&o>0&&S.value[o-1]?.focus()},G=async()=>{const o=v.value.join("");if(o.length!==4){y.value="يرجى إدخال الرمز كاملاً";return}_.value=!0,y.value="";try{const s=await $fetch(`${E}/booking-cards/verify-otp`,{method:"POST",body:{token:I.value,otp:o}});s.success&&(C.value=!1,U.value=s.tracking_code,N.value=!0,D("تم تنفيذ الحجز بنجاح"),K())}catch(s){console.error("Verification failed:",s.data||s),y.value=s.data?.message||"رمز التحقق غير صحيح"}finally{_.value=!1}},K=()=>{n.name="",n.phone="",n.national_id="",n.payment_type="",d.passport=null,d.voucher=null,d.national_id=null,l.passport="",l.voucher="",l.national_id="",v.value=["","","",""],["passport_photo","voucher_photo","national_id_photo"].forEach(s=>{const g=document.getElementById(s);g&&(g.value="")})};return(o,s)=>{const g=W,f=Z;return r(),i("div",ts,[t("div",es,[s[33]||(s[33]=A('<div class="page-header" data-v-19f8f5b0><div class="header-badge" data-v-19f8f5b0><i class="fas fa-id-card" data-v-19f8f5b0></i><span data-v-19f8f5b0>شركة الرحالة للصرافة والخدمات المالية</span></div><h1 class="page-title" data-v-19f8f5b0>تقديم طلب للموافقه علي <span class="gradient-text" data-v-19f8f5b0>شحن بطاقة الأغراض الشخصية</span></h1><p class="page-subtitle" data-v-19f8f5b0>يرجى ملء البيانات بدقة ورفع المستندات المطلوبة لتحويل طلبك للمراجعة</p></div>',1)),t("div",os,[t("form",{onSubmit:J(T,["prevent"])},[t("div",as,[s[17]||(s[17]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-user-edit"}),t("span",null,"المعلومات الشخصية")],-1)),t("div",ls,[t("div",ns,[s[11]||(s[11]=t("label",{class:"label"},[u("الإسم بالكامل "),t("span",{class:"required"},"*")],-1)),k(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>e(n).name=a),type:"text",class:"input",placeholder:"أدخل اسمك كما هو في الجواز",required:""},null,512),[[q,e(n).name]])]),t("div",is,[s[12]||(s[12]=t("label",{class:"label"},[u("الرقم الوطني (12 رقم) "),t("span",{class:"required"},"*")],-1)),k(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>e(n).national_id=a),type:"text",class:"input",maxlength:"12",pattern:"[0-9]{12}",placeholder:"مثال: 119900123456",required:""},null,512),[[q,e(n).national_id]])])]),t("div",rs,[t("div",ds,[s[14]||(s[14]=t("label",{class:"label"},[u("رقم الهاتف "),t("span",{class:"required"},"*")],-1)),k(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>e(n).phone=a),type:"tel",class:"input",placeholder:"مثال: 0912345678",required:""},null,512),[[q,e(n).phone]]),F(g,null,{default:O(()=>[...s[13]||(s[13]=[t("span",{class:"hint"},"يدعم الأرقام الليبية والمصرية - سيتم إرسال الرمز عبر الواتساب",-1)])]),_:1})]),t("div",ps,[s[16]||(s[16]=t("label",{class:"label"},[u("نوع الدفع "),t("span",{class:"required"},"*")],-1)),k(t("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>e(n).payment_type=a),class:"input select-input",required:""},[...s[15]||(s[15]=[t("option",{value:"",disabled:"",selected:""},"اختر نوع الدفع",-1),t("option",{value:0},"نقدي",-1),t("option",{value:1},"مصرف",-1)])],512),[[H,e(n).payment_type]])])])]),s[32]||(s[32]=t("hr",{class:"divider"},null,-1)),t("div",us,[s[30]||(s[30]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-file-invoice"}),t("span",null,"المستندات المطلوبة")],-1)),t("div",fs,[t("div",cs,[s[21]||(s[21]=t("label",{class:"label"},[u("صورة جواز السفر "),t("span",{class:"required"},"*")],-1)),t("div",{class:h(["file-wrapper",{"has-file":e(l).passport}])},[t("input",{type:"file",id:"passport_photo",class:"file-input",onChange:s[4]||(s[4]=a=>$(a,"passport")),accept:"image/*",required:""},null,32),t("label",vs,[e(l).passport?(r(),i("img",{key:1,src:e(l).passport,class:"preview-img"},null,8,ms)):(r(),i(x,{key:0},[s[18]||(s[18]=t("i",{class:"fas fa-passport"},null,-1)),s[19]||(s[19]=t("span",null,"رفع صورة الجواز",-1))],64))]),e(l).passport?(r(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[5]||(s[5]=a=>B("passport"))},[...s[20]||(s[20]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",bs,[s[25]||(s[25]=t("label",{class:"label"},[u("صورة القسيمة "),t("span",{class:"required"},"*")],-1)),t("div",{class:h(["file-wrapper",{"has-file":e(l).voucher}])},[t("input",{type:"file",id:"voucher_photo",class:"file-input",onChange:s[6]||(s[6]=a=>$(a,"voucher")),accept:"image/*",required:""},null,32),t("label",ys,[e(l).voucher?(r(),i("img",{key:1,src:e(l).voucher,class:"preview-img"},null,8,_s)):(r(),i(x,{key:0},[s[22]||(s[22]=t("i",{class:"fas fa-receipt"},null,-1)),s[23]||(s[23]=t("span",null,"رفع صورة القسيمة",-1))],64))]),e(l).voucher?(r(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[7]||(s[7]=a=>B("voucher"))},[...s[24]||(s[24]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",gs,[s[29]||(s[29]=t("label",{class:"label"},[u("صورة الرقم الوطني "),t("span",{class:"required"},"*")],-1)),t("div",{class:h(["file-wrapper",{"has-file":e(l).national_id}])},[t("input",{type:"file",id:"national_id_photo",class:"file-input",onChange:s[8]||(s[8]=a=>$(a,"national_id")),accept:"image/*",required:""},null,32),t("label",ks,[e(l).national_id?(r(),i("img",{key:1,src:e(l).national_id,class:"preview-img"},null,8,hs)):(r(),i(x,{key:0},[s[26]||(s[26]=t("i",{class:"fas fa-id-card-clip"},null,-1)),s[27]||(s[27]=t("span",null,"رفع صورة الرقم الوطني",-1))],64))]),e(l).national_id?(r(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[9]||(s[9]=a=>B("national_id"))},[...s[28]||(s[28]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)])]),s[31]||(s[31]=t("p",{class:"hint files-hint"},"الصيغ المسموحة: JPG, PNG - الحد الأقصى لكل صورة: 5MB",-1))]),t("div",ws,[t("button",{type:"submit",class:"submit-btn",disabled:e(b)},[t("span",null,V(e(b)?"جاري المعالجة...":"التالي (التحقق من الهاتف)"),1),t("i",{class:h(e(b)?"fas fa-spinner fa-spin":"fas fa-arrow-left")},null,2)],8,Cs)])],32)])]),e(C)?(r(),i("div",qs,[t("div",xs,[s[36]||(s[36]=t("div",{class:"bk-modal-header"},[t("i",{class:"fas fa-shield-halved"}),t("h3",null,"التحقق من رقم الهاتف")],-1)),t("div",Vs,[s[35]||(s[35]=t("p",null,[u("تم إرسال رمز التحقق إلى رقم هاتفك عبر الواتساب"),t("br"),u("أدخل الرمز المكون من 4 أرقام")],-1)),t("div",Ss,[(r(),i(x,null,Q(4,a=>k(t("input",{key:a,ref_for:!0,ref:c=>e(S)[a-1]=c,"onUpdate:modelValue":c=>e(v)[a-1]=c,type:"text",class:"bk-otp-input",maxlength:"1",onInput:c=>j(a-1),onKeydown:X(c=>P(a-1),["backspace"]),autocomplete:"one-time-code",inputmode:"numeric"},null,40,$s),[[q,e(v)[a-1]]])),64))]),e(y)?(r(),i("div",Bs,V(e(y)),1)):m("",!0),t("div",Ms,[t("button",{type:"button",class:"submit-btn secondary",onClick:s[10]||(s[10]=a=>C.value=!1)},[...s[34]||(s[34]=[t("span",null,"إغلاق",-1)])]),t("button",{type:"button",class:"submit-btn",onClick:G,disabled:e(_)},[t("i",{class:h(e(_)?"fas fa-spinner fa-spin":"fas fa-check")},null,2),t("span",null,V(e(_)?"جاري التحقق...":"تأكيد الحجز"),1)],8,Fs)])])])])):m("",!0),e(N)?(r(),i("div",Os,[t("div",Es,[t("div",Is,[s[39]||(s[39]=t("div",{class:"success-icon"},[t("i",{class:"fas fa-check-circle"})],-1)),s[40]||(s[40]=t("h2",null,"تم تقديم طلبك بنجاح!",-1)),s[41]||(s[41]=t("p",null,"رقم تتبع الحجز الخاص بك:",-1)),t("div",Ns,V(e(U)),1),s[42]||(s[42]=t("p",{class:"hint"},"احتفظ بهذا الرقم لتتبع حالة حجزك لاحقاً",-1)),t("div",Us,[F(f,{to:"/",class:"submit-btn secondary"},{default:O(()=>[...s[37]||(s[37]=[t("i",{class:"fas fa-home"},null,-1),t("span",null,"الرئيسية",-1)])]),_:1}),F(f,{to:"/booking-cards/track",class:"submit-btn"},{default:O(()=>[...s[38]||(s[38]=[t("i",{class:"fas fa-search"},null,-1),t("span",null,"تتبع الطلب",-1)])]),_:1})])])])])):m("",!0)])}}}),Ls=Y(Ds,[["__scopeId","data-v-19f8f5b0"]]);export{Ls as default};
