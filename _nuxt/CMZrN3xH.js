import{g as R,y as z,x as W,k as $,l as f,c as i,a as t,q as m,e as A,m as J,s as v,d as p,v as y,j as a,b as B,w as M,G as H,n as g,F as C,t as P,r as Q,i as X,o as d,E as Y,_ as Z}from"./BAAOFR7J.js";import{_ as ss}from"./DIlvvCvj.js";import{u as ts}from"./Bx0TWGs_.js";const as={class:"booking-page"},es={class:"container"},os={class:"form-card"},ls={class:"form-section"},ns={class:"form-row"},is={class:"form-group"},ds={class:"form-group"},rs={class:"form-row"},ps={class:"form-group"},us={class:"form-group"},fs={class:"form-row"},cs={class:"form-group"},ms={class:"form-group"},vs={class:"form-section"},bs={class:"file-grid"},ys={class:"form-group"},gs={for:"passport_photo",class:"file-label"},_s={key:1,class:"pdf-preview"},ks=["src"],ws={class:"form-group"},hs={for:"voucher_photo",class:"file-label"},qs={key:1,class:"pdf-preview"},Cs=["src"],Fs={class:"form-group"},xs={for:"national_id_photo",class:"file-label"},Vs={key:1,class:"pdf-preview"},Ds=["src"],Ps={class:"form-group"},Ss={for:"additional_photo",class:"file-label"},$s={key:1,class:"pdf-preview"},Bs=["src"],Ms={class:"submit-wrapper"},Us=["disabled"],Ns={key:0,class:"bk-modal-overlay"},Os={class:"bk-modal"},Es={class:"bk-modal-body"},Is={class:"bk-otp-wrapper"},Ts=["onUpdate:modelValue","onInput","onKeydown"],js={key:0,class:"bk-modal-error"},Gs={class:"bk-modal-actions"},Ks=["disabled"],Ls={key:1,class:"modal-overlay show"},Rs={class:"modal"},zs={class:"modal-body success-body"},Ws={class:"tracking-code-display"},As={class:"success-actions"},Js=R({__name:"index",setup(Hs){z({title:"حجز بطاقة أغراض شخصية | شركة الرحالة",description:"خدمة حجز بطاقات الأغراض الشخصية للمواطنين عبر شركة الرحالة للصرافة"});const{success:I,error:_}=ts(),U=W().public.apiBase,l=$({name:"",phone:"",national_id:"",payment_type:"",account_number:"",booking_amount:""}),r=$({passport:null,voucher:null,national_id:null,additional:null}),n=$({passport:"",voucher:"",national_id:"",additional:""}),k=f(!1),N=f(""),F=f(!1),b=f(["","","",""]),S=f([]),w=f(""),h=f(!1),O=f(!1),E=f(""),x=(e,s)=>{const u=e.target.files?.[0];if(u&&(u.type.startsWith("image/")||u.type==="application/pdf")){if(u.size>10*1024*1024){_("حجم الملف يجب أن يكون أقل من 10MB");return}if(r[s]=u,u.type.startsWith("image/")){const o=new FileReader;o.onload=c=>{n[s]=c.target?.result},o.readAsDataURL(u)}else n[s]="pdf"}},V=e=>r[e]?.type==="application/pdf",D=e=>{r[e]=null,n[e]="";const s=document.getElementById(`${e}_photo`);s&&(s.value="")},T=async()=>{if(!r.passport||!r.voucher||!r.national_id){_("يرجى رفع المستندات الأساسية المطلوبة");return}if(Number(l.booking_amount)>2e3){_("قيمة الحجز لا يمكن أن تتجاوز 2000 دولار");return}k.value=!0;try{const e=new FormData;e.append("name",l.name),e.append("phone",l.phone),e.append("national_id",l.national_id),e.append("payment_type",l.payment_type.toString()),e.append("account_number",l.account_number),e.append("booking_amount",l.booking_amount),r.passport&&e.append("passport_photo",r.passport),r.voucher&&e.append("voucher_photo",r.voucher),r.national_id&&e.append("national_id_photo",r.national_id),r.additional&&e.append("additional_photo",r.additional);const s=await $fetch(`${U}/booking-cards/store`,{method:"POST",body:e});s.success&&(N.value=s.token,F.value=!0)}catch(e){if(console.error("Step 1 failed:",e.data||e),e.data?.errors){const s=Object.values(e.data.errors).flat().join(`
`);_(s)}else _(e.data?.message||"حدث خطأ أثناء إرسال البيانات")}finally{k.value=!1}},j=e=>{b.value[e]&&e<3&&S.value[e+1]?.focus()},G=(e,s)=>{!b.value[e]&&e>0&&S.value[e-1]?.focus()},K=async()=>{const e=b.value.join("");if(e.length!==4){w.value="يرجى إدخال الرمز كاملاً";return}h.value=!0,w.value="";try{const s=await $fetch(`${U}/booking-cards/verify-otp`,{method:"POST",body:{token:N.value,otp:e}});s.success&&(F.value=!1,E.value=s.tracking_code,O.value=!0,I("تم تنفيذ الحجز بنجاح"),L())}catch(s){console.error("Verification failed:",s.data||s),w.value=s.data?.message||"رمز التحقق غير صحيح"}finally{h.value=!1}},L=()=>{l.name="",l.phone="",l.national_id="",l.payment_type="",l.account_number="",l.booking_amount="",r.passport=null,r.voucher=null,r.national_id=null,r.additional=null,n.passport="",n.voucher="",n.national_id="",n.additional="",b.value=["","","",""],["passport_photo","voucher_photo","national_id_photo","additional_photo"].forEach(s=>{const q=document.getElementById(s);q&&(q.value="")})};return(e,s)=>{const q=X,u=ss;return d(),i("div",as,[t("div",es,[s[47]||(s[47]=A('<div class="page-header" data-v-e2a476af><div class="header-badge" data-v-e2a476af><i class="fas fa-id-card" data-v-e2a476af></i><span data-v-e2a476af>شركة الرحالة للصرافة والخدمات المالية</span></div><h1 class="page-title" data-v-e2a476af>تقديم طلب للموافقه علي <span class="gradient-text" data-v-e2a476af>شحن بطاقة الأغراض الشخصية</span></h1><p class="page-subtitle" data-v-e2a476af>يرجى ملء البيانات بدقة ورفع المستندات المطلوبة (صور أو PDF بحد أقصى 10 ميجا)</p></div>',1)),t("div",os,[t("form",{onSubmit:J(T,["prevent"])},[t("div",ls,[s[23]||(s[23]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-user-edit"}),t("span",null,"المعلومات الشخصية")],-1)),t("div",ns,[t("div",is,[s[15]||(s[15]=t("label",{class:"label"},[p("الإسم بالكامل "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>a(l).name=o),type:"text",class:"input",placeholder:"أدخل اسمك كما هو في الجواز",required:""},null,512),[[y,a(l).name]])]),t("div",ds,[s[16]||(s[16]=t("label",{class:"label"},[p("الرقم الوطني (12 رقم) "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>a(l).national_id=o),type:"text",class:"input",maxlength:"12",inputmode:"numeric",pattern:"[0-9]{12}",placeholder:"مثال: 119900123456",required:""},null,512),[[y,a(l).national_id]])])]),t("div",rs,[t("div",ps,[s[18]||(s[18]=t("label",{class:"label"},[p("رقم الهاتف "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>a(l).phone=o),type:"tel",class:"input",placeholder:"مثال: 0912345678",required:""},null,512),[[y,a(l).phone]]),B(q,null,{default:M(()=>[...s[17]||(s[17]=[t("span",{class:"hint"},"يدعم الأرقام الليبية والمصرية - سيتم إرسال الرمز عبر الواتساب",-1)])]),_:1})]),t("div",us,[s[20]||(s[20]=t("label",{class:"label"},[p("نوع الدفع "),t("span",{class:"required"},"*")],-1)),v(t("select",{"onUpdate:modelValue":s[3]||(s[3]=o=>a(l).payment_type=o),class:"input select-input",required:""},[...s[19]||(s[19]=[t("option",{value:"",disabled:"",selected:""},"اختر نوع الدفع",-1),t("option",{value:0},"نقدي",-1),t("option",{value:1},"مصرف",-1)])],512),[[H,a(l).payment_type]])])]),t("div",fs,[t("div",cs,[s[21]||(s[21]=t("label",{class:"label"},[p("رقم الحساب "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>a(l).account_number=o),type:"text",class:"input",inputmode:"numeric",placeholder:"أدخل رقم الحساب الجاري",required:""},null,512),[[y,a(l).account_number]])]),t("div",ms,[s[22]||(s[22]=t("label",{class:"label"},[p("قيمة الحجز بالدولار "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>a(l).booking_amount=o),type:"number",step:"0.01",class:"input",placeholder:"مثال: 100",required:""},null,512),[[y,a(l).booking_amount]])])])]),s[46]||(s[46]=t("hr",{class:"divider"},null,-1)),t("div",vs,[s[44]||(s[44]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-file-invoice"}),t("span",null,"المستندات المطلوبة")],-1)),t("div",bs,[t("div",ys,[s[28]||(s[28]=t("label",{class:"label"},[p("صورة جواز السفر "),t("span",{class:"required"},"*")],-1)),t("div",{class:g(["file-wrapper",{"has-file":a(n).passport}])},[t("input",{type:"file",id:"passport_photo",class:"file-input",onChange:s[6]||(s[6]=o=>x(o,"passport")),accept:"image/*,.pdf",required:""},null,32),t("label",gs,[a(n).passport?V("passport")?(d(),i("div",_s,[...s[26]||(s[26]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(d(),i("img",{key:2,src:a(n).passport,class:"preview-img"},null,8,ks)):(d(),i(C,{key:0},[s[24]||(s[24]=t("i",{class:"fas fa-file-upload"},null,-1)),s[25]||(s[25]=t("span",null,"رفع الجواز (صورة أو PDF)",-1))],64))]),a(n).passport?(d(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[7]||(s[7]=o=>D("passport"))},[...s[27]||(s[27]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",ws,[s[33]||(s[33]=t("label",{class:"label"},[p("صورة القسيمة "),t("span",{class:"required"},"*")],-1)),t("div",{class:g(["file-wrapper",{"has-file":a(n).voucher}])},[t("input",{type:"file",id:"voucher_photo",class:"file-input",onChange:s[8]||(s[8]=o=>x(o,"voucher")),accept:"image/*,.pdf",required:""},null,32),t("label",hs,[a(n).voucher?V("voucher")?(d(),i("div",qs,[...s[31]||(s[31]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(d(),i("img",{key:2,src:a(n).voucher,class:"preview-img"},null,8,Cs)):(d(),i(C,{key:0},[s[29]||(s[29]=t("i",{class:"fas fa-receipt"},null,-1)),s[30]||(s[30]=t("span",null,"رفع القسيمة (صورة أو PDF)",-1))],64))]),a(n).voucher?(d(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[9]||(s[9]=o=>D("voucher"))},[...s[32]||(s[32]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",Fs,[s[38]||(s[38]=t("label",{class:"label"},[p("صورة الرقم الوطني "),t("span",{class:"required"},"*")],-1)),t("div",{class:g(["file-wrapper",{"has-file":a(n).national_id}])},[t("input",{type:"file",id:"national_id_photo",class:"file-input",onChange:s[10]||(s[10]=o=>x(o,"national_id")),accept:"image/*,.pdf",required:""},null,32),t("label",xs,[a(n).national_id?V("national_id")?(d(),i("div",Vs,[...s[36]||(s[36]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(d(),i("img",{key:2,src:a(n).national_id,class:"preview-img"},null,8,Ds)):(d(),i(C,{key:0},[s[34]||(s[34]=t("i",{class:"fas fa-address-card"},null,-1)),s[35]||(s[35]=t("span",null,"رفع الرقم الوطني (صورة أو PDF)",-1))],64))]),a(n).national_id?(d(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[11]||(s[11]=o=>D("national_id"))},[...s[37]||(s[37]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",Ps,[s[43]||(s[43]=t("label",{class:"label"},"صورة إضافية (اختياري)",-1)),t("div",{class:g(["file-wrapper",{"has-file":a(n).additional}])},[t("input",{type:"file",id:"additional_photo",class:"file-input",onChange:s[12]||(s[12]=o=>x(o,"additional")),accept:"image/*,.pdf"},null,32),t("label",Ss,[a(n).additional?V("additional")?(d(),i("div",$s,[...s[41]||(s[41]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(d(),i("img",{key:2,src:a(n).additional,class:"preview-img"},null,8,Bs)):(d(),i(C,{key:0},[s[39]||(s[39]=t("i",{class:"fas fa-plus-circle"},null,-1)),s[40]||(s[40]=t("span",null,"رفع مستند إضافي",-1))],64))]),a(n).additional?(d(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[13]||(s[13]=o=>D("additional"))},[...s[42]||(s[42]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)])]),s[45]||(s[45]=t("p",{class:"hint files-hint"},"الصيغ المسموحة: JPG, PNG, PDF - الحد الأقصى لكل ملف: 10MB",-1))]),t("div",Ms,[t("button",{type:"submit",class:"submit-btn",disabled:a(k)},[t("span",null,P(a(k)?"جاري المعالجة...":"التالي (التحقق من الهاتف)"),1),t("i",{class:g(a(k)?"fas fa-spinner fa-spin":"fas fa-arrow-left")},null,2)],8,Us)])],32)])]),a(F)?(d(),i("div",Ns,[t("div",Os,[s[50]||(s[50]=t("div",{class:"bk-modal-header"},[t("i",{class:"fas fa-shield-halved"}),t("h3",null,"التحقق من رقم الهاتف")],-1)),t("div",Es,[s[49]||(s[49]=t("p",null,[p("تم إرسال رمز التحقق إلى رقم هاتفك عبر الواتساب"),t("br"),p("أدخل الرمز المكون من 4 أرقام")],-1)),t("div",Is,[(d(),i(C,null,Q(4,o=>v(t("input",{key:o,ref_for:!0,ref:c=>a(S)[o-1]=c,"onUpdate:modelValue":c=>a(b)[o-1]=c,type:"text",class:"bk-otp-input",maxlength:"1",onInput:c=>j(o-1),onKeydown:Y(c=>G(o-1),["backspace"]),autocomplete:"one-time-code",inputmode:"numeric"},null,40,Ts),[[y,a(b)[o-1]]])),64))]),a(w)?(d(),i("div",js,P(a(w)),1)):m("",!0),t("div",Gs,[t("button",{type:"button",class:"submit-btn secondary",onClick:s[14]||(s[14]=o=>F.value=!1)},[...s[48]||(s[48]=[t("span",null,"إغلاق",-1)])]),t("button",{type:"button",class:"submit-btn",onClick:K,disabled:a(h)},[t("i",{class:g(a(h)?"fas fa-spinner fa-spin":"fas fa-check")},null,2),t("span",null,P(a(h)?"جاري التحقق...":"تأكيد الحجز"),1)],8,Ks)])])])])):m("",!0),a(O)?(d(),i("div",Ls,[t("div",Rs,[t("div",zs,[s[53]||(s[53]=t("div",{class:"success-icon"},[t("i",{class:"fas fa-check-circle"})],-1)),s[54]||(s[54]=t("h2",null,"تم تقديم طلبك بنجاح!",-1)),s[55]||(s[55]=t("p",null,"رقم تتبع الحجز الخاص بك:",-1)),t("div",Ws,P(a(E)),1),s[56]||(s[56]=t("p",{class:"hint"},"احتفظ بهذا الرقم لتتبع حالة حجزك لاحقاً",-1)),t("div",As,[B(u,{to:"/",class:"submit-btn secondary"},{default:M(()=>[...s[51]||(s[51]=[t("i",{class:"fas fa-home"},null,-1),t("span",null,"الرئيسية",-1)])]),_:1}),B(u,{to:"/booking-cards/track",class:"submit-btn"},{default:M(()=>[...s[52]||(s[52]=[t("i",{class:"fas fa-search"},null,-1),t("span",null,"تتبع الطلب",-1)])]),_:1})])])])])):m("",!0)])}}}),st=Z(Js,[["__scopeId","data-v-e2a476af"]]);export{st as default};
