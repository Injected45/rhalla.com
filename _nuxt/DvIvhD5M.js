import{g as R,y as z,x as G,k as F,l as p,c as n,a as t,q as m,e as A,m as J,s as C,d as u,v as x,j as o,b as M,w as O,n as k,F as q,t as V,r as H,i as Q,o as i,E as W,_ as X}from"./B057cM1m.js";import{_ as Y}from"./Qzz9LfvA.js";import{u as Z}from"./Ci9JCjjJ.js";const ss={class:"booking-page"},ts={class:"container"},es={class:"form-card"},os={class:"form-section"},as={class:"form-row"},ls={class:"form-group"},ns={class:"form-group"},is={class:"form-row"},rs={class:"form-group"},ds={class:"form-section"},ps={class:"file-grid"},us={class:"form-group"},cs={for:"passport_photo",class:"file-label"},fs=["src"],vs={class:"form-group"},ms={for:"voucher_photo",class:"file-label"},bs=["src"],_s={class:"form-group"},gs={for:"national_id_photo",class:"file-label"},ys=["src"],ks={class:"submit-wrapper"},hs=["disabled"],ws={key:0,class:"bk-modal-overlay"},Cs={class:"bk-modal"},xs={class:"bk-modal-body"},qs={class:"bk-otp-wrapper"},Vs=["onUpdate:modelValue","onInput","onKeydown"],$s={key:0,class:"bk-modal-error"},Bs={class:"bk-modal-actions"},Ss=["disabled"],Fs={key:1,class:"modal-overlay show"},Ms={class:"modal"},Os={class:"modal-body success-body"},Es={class:"tracking-code-display"},Is={class:"success-actions"},Ns=R({__name:"index",setup(Us){z({title:"حجز بطاقة أغراض شخصية | شركة الرحالة",description:"خدمة حجز بطاقات الأغراض الشخصية للمواطنين عبر شركة الرحالة للصرافة"});const{success:D,error:h}=Z(),E=G().public.apiBase,r=F({name:"",phone:"",national_id:""}),d=F({passport:null,voucher:null,national_id:null}),l=F({passport:"",voucher:"",national_id:""}),b=p(!1),I=p(""),w=p(!1),v=p(["","","",""]),$=p([]),_=p(""),g=p(!1),N=p(!1),U=p(""),B=(e,s)=>{const c=e.target.files?.[0];if(c){if(c.size>5*1024*1024){h("حجم الصورة يجب أن يكون أقل من 5MB");return}d[s]=c;const a=new FileReader;a.onload=f=>{l[s]=f.target?.result},a.readAsDataURL(c)}},S=e=>{d[e]=null,l[e]="";const s=document.getElementById(`${e}_photo`);s&&(s.value="")},T=async()=>{if(!d.passport||!d.voucher||!d.national_id){h("يرجى رفع جميع الصور المطلوبة");return}b.value=!0;try{const e=new FormData;e.append("name",r.name),e.append("phone",r.phone),e.append("national_id",r.national_id),e.append("passport_photo",d.passport),e.append("voucher_photo",d.voucher),e.append("national_id_photo",d.national_id);const s=await $fetch(`${E}/booking-cards/store`,{method:"POST",body:e});s.success&&(I.value=s.token,w.value=!0)}catch(e){if(console.error("Step 1 failed:",e.data||e),e.data?.errors){const s=Object.values(e.data.errors).flat().join(`
`);h(s)}else h(e.data?.message||"حدث خطأ أثناء إرسال البيانات")}finally{b.value=!1}},j=e=>{v.value[e]&&e<3&&$.value[e+1]?.focus()},P=(e,s)=>{!v.value[e]&&e>0&&$.value[e-1]?.focus()},K=async()=>{const e=v.value.join("");if(e.length!==4){_.value="يرجى إدخال الرمز كاملاً";return}g.value=!0,_.value="";try{const s=await $fetch(`${E}/booking-cards/verify-otp`,{method:"POST",body:{token:I.value,otp:e}});s.success&&(w.value=!1,U.value=s.tracking_code,N.value=!0,D("تم تنفيذ الحجز بنجاح"),L())}catch(s){console.error("Verification failed:",s.data||s),_.value=s.data?.message||"رمز التحقق غير صحيح"}finally{g.value=!1}},L=()=>{r.name="",r.phone="",r.national_id="",d.passport=null,d.voucher=null,d.national_id=null,l.passport="",l.voucher="",l.national_id="",v.value=["","","",""],["passport_photo","voucher_photo","national_id_photo"].forEach(s=>{const y=document.getElementById(s);y&&(y.value="")})};return(e,s)=>{const y=Q,c=Y;return i(),n("div",ss,[t("div",ts,[s[30]||(s[30]=A('<div class="page-header" data-v-3223eeaf><div class="header-badge" data-v-3223eeaf><i class="fas fa-id-card" data-v-3223eeaf></i><span data-v-3223eeaf>حجز بطاقات الأغراض الشخصية</span></div><h1 class="page-title" data-v-3223eeaf>طلب حجز <span class="gradient-text" data-v-3223eeaf>بطاقة أغراض شخصية</span></h1><p class="page-subtitle" data-v-3223eeaf>يرجى ملء جميع البيانات ورفع المستندات المطلوبة بدقة</p></div>',1)),t("div",es,[t("form",{onSubmit:J(T,["prevent"])},[t("div",os,[s[14]||(s[14]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-user-edit"}),t("span",null,"المعلومات الشخصية")],-1)),t("div",as,[t("div",ls,[s[10]||(s[10]=t("label",{class:"label"},[u("الإسم بالكامل "),t("span",{class:"required"},"*")],-1)),C(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>o(r).name=a),type:"text",class:"input",placeholder:"أدخل اسمك كما هو في الجواز",required:""},null,512),[[x,o(r).name]])]),t("div",ns,[s[11]||(s[11]=t("label",{class:"label"},[u("الرقم الوطني (12 رقم) "),t("span",{class:"required"},"*")],-1)),C(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o(r).national_id=a),type:"text",class:"input",maxlength:"12",pattern:"[0-9]{12}",placeholder:"مثال: 119900123456",required:""},null,512),[[x,o(r).national_id]])])]),t("div",is,[t("div",rs,[s[13]||(s[13]=t("label",{class:"label"},[u("رقم الهاتف "),t("span",{class:"required"},"*")],-1)),C(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>o(r).phone=a),type:"tel",class:"input",placeholder:"مثال: 0912345678",required:""},null,512),[[x,o(r).phone]]),M(y,null,{default:O(()=>[...s[12]||(s[12]=[t("span",{class:"hint"},"يدعم الأرقام الليبية والمصرية - سيتم إرسال الرمز عبر الواتساب",-1)])]),_:1})])])]),s[29]||(s[29]=t("hr",{class:"divider"},null,-1)),t("div",ds,[s[27]||(s[27]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-file-invoice"}),t("span",null,"المستندات المطلوبة")],-1)),t("div",ps,[t("div",us,[s[18]||(s[18]=t("label",{class:"label"},[u("صورة جواز السفر "),t("span",{class:"required"},"*")],-1)),t("div",{class:k(["file-wrapper",{"has-file":o(l).passport}])},[t("input",{type:"file",id:"passport_photo",class:"file-input",onChange:s[3]||(s[3]=a=>B(a,"passport")),accept:"image/*",required:""},null,32),t("label",cs,[o(l).passport?(i(),n("img",{key:1,src:o(l).passport,class:"preview-img"},null,8,fs)):(i(),n(q,{key:0},[s[15]||(s[15]=t("i",{class:"fas fa-passport"},null,-1)),s[16]||(s[16]=t("span",null,"رفع صورة الجواز",-1))],64))]),o(l).passport?(i(),n("button",{key:0,type:"button",class:"remove-btn",onClick:s[4]||(s[4]=a=>S("passport"))},[...s[17]||(s[17]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",vs,[s[22]||(s[22]=t("label",{class:"label"},[u("صورة القسيمة "),t("span",{class:"required"},"*")],-1)),t("div",{class:k(["file-wrapper",{"has-file":o(l).voucher}])},[t("input",{type:"file",id:"voucher_photo",class:"file-input",onChange:s[5]||(s[5]=a=>B(a,"voucher")),accept:"image/*",required:""},null,32),t("label",ms,[o(l).voucher?(i(),n("img",{key:1,src:o(l).voucher,class:"preview-img"},null,8,bs)):(i(),n(q,{key:0},[s[19]||(s[19]=t("i",{class:"fas fa-receipt"},null,-1)),s[20]||(s[20]=t("span",null,"رفع صورة القسيمة",-1))],64))]),o(l).voucher?(i(),n("button",{key:0,type:"button",class:"remove-btn",onClick:s[6]||(s[6]=a=>S("voucher"))},[...s[21]||(s[21]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)]),t("div",_s,[s[26]||(s[26]=t("label",{class:"label"},[u("صورة الرقم الوطني "),t("span",{class:"required"},"*")],-1)),t("div",{class:k(["file-wrapper",{"has-file":o(l).national_id}])},[t("input",{type:"file",id:"national_id_photo",class:"file-input",onChange:s[7]||(s[7]=a=>B(a,"national_id")),accept:"image/*",required:""},null,32),t("label",gs,[o(l).national_id?(i(),n("img",{key:1,src:o(l).national_id,class:"preview-img"},null,8,ys)):(i(),n(q,{key:0},[s[23]||(s[23]=t("i",{class:"fas fa-id-card-clip"},null,-1)),s[24]||(s[24]=t("span",null,"رفع صورة الرقم الوطني",-1))],64))]),o(l).national_id?(i(),n("button",{key:0,type:"button",class:"remove-btn",onClick:s[8]||(s[8]=a=>S("national_id"))},[...s[25]||(s[25]=[t("i",{class:"fas fa-times"},null,-1)])])):m("",!0)],2)])]),s[28]||(s[28]=t("p",{class:"hint files-hint"},"الصيغ المسموحة: JPG, PNG - الحد الأقصى لكل صورة: 5MB",-1))]),t("div",ks,[t("button",{type:"submit",class:"submit-btn",disabled:o(b)},[t("span",null,V(o(b)?"جاري المعالجة...":"التالي (التحقق من الهاتف)"),1),t("i",{class:k(o(b)?"fas fa-spinner fa-spin":"fas fa-arrow-left")},null,2)],8,hs)])],32)])]),o(w)?(i(),n("div",ws,[t("div",Cs,[s[33]||(s[33]=t("div",{class:"bk-modal-header"},[t("i",{class:"fas fa-shield-halved"}),t("h3",null,"التحقق من رقم الهاتف")],-1)),t("div",xs,[s[32]||(s[32]=t("p",null,[u("تم إرسال رمز التحقق إلى رقم هاتفك عبر الواتساب"),t("br"),u("أدخل الرمز المكون من 4 أرقام")],-1)),t("div",qs,[(i(),n(q,null,H(4,a=>C(t("input",{key:a,ref_for:!0,ref:f=>o($)[a-1]=f,"onUpdate:modelValue":f=>o(v)[a-1]=f,type:"text",class:"bk-otp-input",maxlength:"1",onInput:f=>j(a-1),onKeydown:W(f=>P(a-1),["backspace"]),autocomplete:"one-time-code",inputmode:"numeric"},null,40,Vs),[[x,o(v)[a-1]]])),64))]),o(_)?(i(),n("div",$s,V(o(_)),1)):m("",!0),t("div",Bs,[t("button",{type:"button",class:"submit-btn secondary",onClick:s[9]||(s[9]=a=>w.value=!1)},[...s[31]||(s[31]=[t("span",null,"إغلاق",-1)])]),t("button",{type:"button",class:"submit-btn",onClick:K,disabled:o(g)},[t("i",{class:k(o(g)?"fas fa-spinner fa-spin":"fas fa-check")},null,2),t("span",null,V(o(g)?"جاري التحقق...":"تأكيد الحجز"),1)],8,Ss)])])])])):m("",!0),o(N)?(i(),n("div",Fs,[t("div",Ms,[t("div",Os,[s[36]||(s[36]=t("div",{class:"success-icon"},[t("i",{class:"fas fa-check-circle"})],-1)),s[37]||(s[37]=t("h2",null,"تم تقديم طلبك بنجاح!",-1)),s[38]||(s[38]=t("p",null,"رقم تتبع الحجز الخاص بك:",-1)),t("div",Es,V(o(U)),1),s[39]||(s[39]=t("p",{class:"hint"},"احتفظ بهذا الرقم لتتبع حالة حجزك لاحقاً",-1)),t("div",Is,[M(c,{to:"/",class:"submit-btn secondary"},{default:O(()=>[...s[34]||(s[34]=[t("i",{class:"fas fa-home"},null,-1),t("span",null,"الرئيسية",-1)])]),_:1}),M(c,{to:"/booking-cards/track",class:"submit-btn"},{default:O(()=>[...s[35]||(s[35]=[t("i",{class:"fas fa-search"},null,-1),t("span",null,"تتبع الطلب",-1)])]),_:1})])])])])):m("",!0)])}}}),Ks=X(Ns,[["__scopeId","data-v-3223eeaf"]]);export{Ks as default};
