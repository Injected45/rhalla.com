import{g as X,y as Y,H as Z,x as ss,l as u,B as ts,C as as,D as es,k as S,c as l,a as s,q as k,d as m,b as C,w as D,j as a,F as $,t as _,n as q,m as ns,s as v,v as h,G as os,i as ls,o as i,_ as is}from"./B_ymwll6.js";import{_ as rs}from"./B4Wgx5kP.js";import{u as ds}from"./J4tkXWXr.js";const ps={class:"booking-page"},us={class:"container"},cs={class:"page-header"},ms={class:"bank-logo-wrapper"},fs={class:"bank-logo-container"},_s=["src"],bs={key:0,class:"loading-state"},vs={key:1,class:"disabled-message"},gs={key:0,class:"marquee-wrapper"},ys={class:"marquee-banner"},ks={class:"marquee-track"},hs={class:"marquee-text"},ws={class:"marquee-text"},qs={class:"marquee-text"},xs={class:"marquee-text"},Ss={class:"marquee-text"},Cs={class:"marquee-text"},Ds={class:"form-card"},$s=["disabled"],Fs={class:"form-section"},Bs={class:"form-row"},Is={class:"form-group"},Vs={class:"form-group"},Ms={class:"form-row"},Ps={class:"form-group"},Ns={class:"form-group"},Us={class:"form-row"},Es={class:"form-group"},Ts={class:"form-group"},Os={class:"form-section"},Rs={class:"file-grid"},js={class:"form-group"},zs={for:"passport_photo",class:"file-label"},Ls={key:1,class:"pdf-preview"},Ws=["src"],As={class:"form-group"},Gs={for:"national_id_photo",class:"file-label"},Hs={key:1,class:"pdf-preview"},Js=["src"],Ks={class:"submit-wrapper"},Qs=["disabled"],Xs={key:0,class:"modal-overlay show"},Ys={class:"modal"},Zs={class:"modal-body success-body"},st={class:"tracking-code-display"},tt={class:"success-actions"},at=X({__name:"index",setup(et){Y({title:"حجز بطاقة أغراض شخصية | شركة الرحالة",description:"خدمة حجز بطاقات الأغراض الشخصية للمواطنين عبر شركة الرحالة للصرافة"});const{isDark:E}=Z(),{success:T,error:g}=ds(),F=ss().public.apiBase,c=u("loading"),b=u(""),O={0:"الأحد",1:"الإثنين",2:"الثلاثاء",3:"الأربعاء",4:"الخميس",5:"الجمعة",6:"السبت"};function R(e){if(!e)return"";const t=e.replace("T"," ").replace(/[+-]\d{2}:\d{2}$/,"").trim(),[f,d]=t.split(" ");if(!f)return"";const[o,w,N]=f.split("-"),[W,A]=(d||"00:00").split(":"),G=new Date(parseInt(o),parseInt(w)-1,parseInt(N)),H=O[G.getDay()]||"القادم",U=parseInt(W),J=U%12||12,K=U<12?"صباحاً":"مساءً",Q=String(J);return`سوف تفتح المنصة يوم ${H} الموافق ${N}-${w}-${o}م الساعة ${Q}:${A} ${K} — كونوا مستعدين ومستوفيين للشروط`}let x=null;ts(async()=>{const e=async()=>{try{const t=await $fetch(`${F}/booking-cards/status`);console.log("Booking Status Sync:",t),t&&t.status?(c.value=t.status,t.status==="scheduled"&&t.scheduled_date&&(b.value=R(t.scheduled_date))):c.value="open"}catch(t){console.warn("Status Fetch Error (Check CORS or Server):",t),c.value="disabled"}};await e(),x=as(e,6e4)}),es(()=>{x&&clearInterval(x)});const n=S({name:"",phone:"",national_id:"",payment_type:"",account_number:"",booking_amount:""}),p=S({passport:null,national_id:null}),r=S({passport:"",national_id:""}),y=u(!1);u(""),u(!1);const j=u(["","","",""]);u([]),u(""),u(!1);const B=u(!1),I=u(""),V=(e,t)=>{const d=e.target.files?.[0];if(d&&(d.type.startsWith("image/")||d.type==="application/pdf")){if(d.size>10*1024*1024){g("حجم الملف يجب أن يكون أقل من 10MB");return}if(p[t]=d,d.type.startsWith("image/")){const o=new FileReader;o.onload=w=>{r[t]=w.target?.result},o.readAsDataURL(d)}else r[t]="pdf"}},M=e=>p[e]?.type==="application/pdf",P=e=>{p[e]=null,r[e]="";const t=document.getElementById(`${e}_photo`);t&&(t.value="")},z=async()=>{if(!p.passport||!p.national_id){g("يرجى رفع المستندات الأساسية المطلوبة");return}if(Number(n.booking_amount)>2e3){g("قيمة الحجز لا يمكن أن تتجاوز 2000 دولار");return}y.value=!0;try{const e=new FormData;e.append("name",n.name),e.append("phone",n.phone),e.append("national_id",n.national_id),e.append("payment_type",n.payment_type.toString()),e.append("account_number",n.account_number),e.append("booking_amount",n.booking_amount),p.passport&&e.append("passport_photo",p.passport),p.national_id&&e.append("national_id_photo",p.national_id);const t=await $fetch(`${F}/booking-cards/store`,{method:"POST",body:e});t.success&&(I.value=t.tracking_code,B.value=!0,T("تم تقديم طلب حجز البطاقة بنجاح"),L())}catch(e){if(console.error("Step 1 failed:",e.data||e),e.data?.errors){const t=Object.values(e.data.errors).flat().join(`
`);g(t)}else g(e.data?.message||"حدث خطأ أثناء إرسال البيانات")}finally{y.value=!1}},L=()=>{n.name="",n.phone="",n.national_id="",n.payment_type="",n.account_number="",n.booking_amount="",p.passport=null,p.national_id=null,r.passport="",r.national_id="",j.value=["","","",""],["passport_photo","national_id_photo"].forEach(t=>{const f=document.getElementById(t);f&&(f.value="")})};return(e,t)=>{const f=ls,d=rs;return i(),l("div",ps,[s("div",us,[s("div",cs,[t[11]||(t[11]=s("div",{class:"header-badge"},[s("i",{class:"fas fa-id-card"}),s("span",null,"شركة الرحالة للصرافة والخدمات المالية")],-1)),t[12]||(t[12]=s("h1",{class:"page-title"},[m("منصة الرحالة "),s("span",{class:"gradient-text"},"للصرافة مخصصه لزبائن المصرف التجاري الوطني")],-1)),s("div",ms,[C(f,null,{default:D(()=>[s("div",fs,[s("img",{src:a(E)?"/images/ncb-dark.png":"/images/ncb-light.png",alt:"National Commercial Bank",class:"bank-logo"},null,8,_s),t[10]||(t[10]=s("div",{class:"logo-shimmer"},null,-1))])]),_:1})])]),a(c)==="loading"?(i(),l("div",bs,[...t[13]||(t[13]=[s("div",{class:"spinner"},null,-1),s("p",null,"جاري التحقق من حالة المنصة...",-1)])])):a(c)==="disabled"?(i(),l("div",vs,[...t[14]||(t[14]=[s("div",{class:"disabled-card"},[s("i",{class:"fas fa-ban disabled-icon"}),s("h2",null,"المنصة غير متاحة حاليًا."),s("p",null,"منصة الرحالة مرتبطة تقنيًا بمنصة مصرف ليبيا المركزي، وتعمل فقط خلال فترات الحجز الرسمية")],-1)])])):a(c)==="scheduled"||a(c)==="open"?(i(),l($,{key:2},[a(c)==="scheduled"?(i(),l("div",gs,[s("div",ys,[s("div",ks,[s("span",hs,_(a(b)),1),s("span",ws,_(a(b)),1),s("span",qs,_(a(b)),1),s("span",xs,_(a(b)),1),s("span",Ss,_(a(b)),1),s("span",Cs,_(a(b)),1)])])])):k("",!0),s("div",Ds,[s("fieldset",{disabled:a(c)==="scheduled",class:q({"form-disabled":a(c)==="scheduled"})},[s("form",{onSubmit:ns(z,["prevent"])},[t[35]||(t[35]=s("div",{class:"status-alert warning"},[s("i",{class:"fas fa-exclamation-circle"}),s("span",null,[s("strong",null,"تنويه هام:"),s("br"),m("رفع البيانات مخصص فقط لمن قام بحجز المخصص عبر منصة مصرف ليبيا المركزي واختار شركة الرحالة لتأكيد الحجز")])],-1)),s("div",Fs,[t[22]||(t[22]=s("h3",{class:"section-title"},[s("i",{class:"fas fa-user-edit"}),s("span",null,"المعلومات الشخصية")],-1)),s("div",Bs,[s("div",Is,[t[15]||(t[15]=s("label",{class:"label"},[m("الإسم بالكامل "),s("span",{class:"required"},"*")],-1)),v(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>a(n).name=o),type:"text",class:"input",placeholder:"أدخل اسمك كما هو في الجواز",required:""},null,512),[[h,a(n).name]])]),s("div",Vs,[t[16]||(t[16]=s("label",{class:"label"},[m("الرقم الوطني (12 رقم) "),s("span",{class:"required"},"*")],-1)),v(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>a(n).national_id=o),type:"text",class:"input",maxlength:"12",inputmode:"numeric",pattern:"[0-9]{12}",placeholder:"مثال: 119900123456",required:""},null,512),[[h,a(n).national_id]])])]),s("div",Ms,[s("div",Ps,[t[17]||(t[17]=s("label",{class:"label"},[m("رقم الهاتف "),s("span",{class:"required"},"*")],-1)),v(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a(n).phone=o),type:"tel",class:"input",placeholder:"مثال: 0912345678",required:""},null,512),[[h,a(n).phone]])]),s("div",Ns,[t[19]||(t[19]=s("label",{class:"label"},[m("نوع الدفع "),s("span",{class:"required"},"*")],-1)),v(s("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>a(n).payment_type=o),class:"input select-input",required:""},[...t[18]||(t[18]=[s("option",{value:"",disabled:"",selected:""},"اختر نوع الدفع",-1),s("option",{value:0},"نقدي",-1),s("option",{value:1},"مصرف",-1)])],512),[[os,a(n).payment_type]])])]),s("div",Us,[s("div",Es,[t[20]||(t[20]=s("label",{class:"label"},[m("رقم الحساب "),s("span",{class:"required"},"*")],-1)),v(s("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a(n).account_number=o),type:"text",class:"input",inputmode:"numeric",placeholder:"أدخل رقم الحساب الجاري",required:""},null,512),[[h,a(n).account_number]])]),s("div",Ts,[t[21]||(t[21]=s("label",{class:"label"},[m("قيمة الحجز بالدولار "),s("span",{class:"required"},"*")],-1)),v(s("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>a(n).booking_amount=o),type:"number",step:"0.01",class:"input",placeholder:"مثال: 100",required:""},null,512),[[h,a(n).booking_amount]])])])]),t[36]||(t[36]=s("hr",{class:"divider"},null,-1)),s("div",Os,[t[33]||(t[33]=s("h3",{class:"section-title"},[s("i",{class:"fas fa-file-invoice"}),s("span",null,"المستندات المطلوبة")],-1)),t[34]||(t[34]=s("div",{class:"status-alert warning",style:{"margin-bottom":"25px"}},[s("i",{class:"fas fa-info-circle"}),s("span",null,"يرجى ملء البيانات بدقة ورفع المستندات المطلوبة (صور أو PDF بحد أقصى 10 ميجا)")],-1)),s("div",Rs,[s("div",js,[t[27]||(t[27]=s("label",{class:"label"},[m("صورة جواز السفر "),s("span",{class:"required"},"*")],-1)),s("div",{class:q(["file-wrapper",{"has-file":a(r).passport}])},[s("input",{type:"file",id:"passport_photo",class:"file-input",onChange:t[6]||(t[6]=o=>V(o,"passport")),accept:"image/*,.pdf",required:""},null,32),s("label",zs,[a(r).passport?M("passport")?(i(),l("div",Ls,[...t[25]||(t[25]=[s("i",{class:"fas fa-file-pdf"},null,-1),s("span",null,"PDF جاهز",-1)])])):(i(),l("img",{key:2,src:a(r).passport,class:"preview-img"},null,8,Ws)):(i(),l($,{key:0},[t[23]||(t[23]=s("i",{class:"fas fa-file-upload"},null,-1)),t[24]||(t[24]=s("span",null,"رفع الجواز (صورة أو PDF)",-1))],64))]),a(r).passport?(i(),l("button",{key:0,type:"button",class:"remove-btn",onClick:t[7]||(t[7]=o=>P("passport"))},[...t[26]||(t[26]=[s("i",{class:"fas fa-times"},null,-1)])])):k("",!0)],2)]),s("div",As,[t[32]||(t[32]=s("label",{class:"label"},[m("صورة شهادة الرقم الوطني "),s("span",{class:"required"},"*")],-1)),s("div",{class:q(["file-wrapper",{"has-file":a(r).national_id}])},[s("input",{type:"file",id:"national_id_photo",class:"file-input",onChange:t[8]||(t[8]=o=>V(o,"national_id")),accept:"image/*,.pdf",required:""},null,32),s("label",Gs,[a(r).national_id?M("national_id")?(i(),l("div",Hs,[...t[30]||(t[30]=[s("i",{class:"fas fa-file-pdf"},null,-1),s("span",null,"PDF جاهز",-1)])])):(i(),l("img",{key:2,src:a(r).national_id,class:"preview-img"},null,8,Js)):(i(),l($,{key:0},[t[28]||(t[28]=s("i",{class:"fas fa-address-card"},null,-1)),t[29]||(t[29]=s("span",null,"رفع شهادة الرقم الوطني (صورة أو PDF)",-1))],64))]),a(r).national_id?(i(),l("button",{key:0,type:"button",class:"remove-btn",onClick:t[9]||(t[9]=o=>P("national_id"))},[...t[31]||(t[31]=[s("i",{class:"fas fa-times"},null,-1)])])):k("",!0)],2)])])]),t[37]||(t[37]=s("div",{class:"status-alert warning bottom-alert"},[s("i",{class:"fas fa-exclamation-triangle"}),s("span",null,"لن يتم قبول أي طلب ما لم يتم إتمام الحجز عبر منصة مصرف ليبيا المركزي واختيار شركة الرحالة مسبقًا")],-1)),s("div",Ks,[s("button",{type:"submit",class:"submit-btn",disabled:a(y)},[s("span",null,_(a(y)?"جاري المعالجة...":"ارسال المرفقات"),1),s("i",{class:q(a(y)?"fas fa-spinner fa-spin":"fas fa-paper-plane")},null,2)],8,Qs)])],32)],10,$s)])],64)):k("",!0)]),a(B)?(i(),l("div",Xs,[s("div",Ys,[s("div",Zs,[t[40]||(t[40]=s("div",{class:"success-icon"},[s("i",{class:"fas fa-check-circle"})],-1)),t[41]||(t[41]=s("h2",null,"تم تقديم طلبك بنجاح!",-1)),t[42]||(t[42]=s("p",null,"رقم تتبع الحجز الخاص بك:",-1)),s("div",st,_(a(I)),1),t[43]||(t[43]=s("p",{class:"hint"},"احتفظ بهذا الرقم لتتبع حالة حجزك لاحقاً",-1)),s("div",tt,[C(d,{to:"/",class:"submit-btn secondary"},{default:D(()=>[...t[38]||(t[38]=[s("i",{class:"fas fa-home"},null,-1),s("span",null,"الرئيسية",-1)])]),_:1}),C(d,{to:"/booking-cards/track",class:"submit-btn"},{default:D(()=>[...t[39]||(t[39]=[s("i",{class:"fas fa-search"},null,-1),s("span",null,"تتبع الطلب",-1)])]),_:1})])])])])):k("",!0)])}}}),rt=is(at,[["__scopeId","data-v-084ffefa"]]);export{rt as default};
