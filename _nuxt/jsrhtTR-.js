import{A as x,x as _,g as L,y as U,l as p,h as y,B as k,C as F,D as w,c,a as e,n as B,j as i,f as $,F as g,r as m,t as l,o,_ as S}from"./DgPf9jRU.js";const D=x("currency",{state:()=>({internalCurrencies:[],externalCurrencies:[],internalLastUpdated:"",externalLastUpdated:"",featuredCurrencies:[],featuredLastUpdated:"",loading:!1,error:null,hasFetched:!1}),actions:{async fetchCurrencies(d=!1){if(this.hasFetched&&!d)return;this.loading=!0,this.error=null;const a=_(),f=a.public.useFeaturedCurrencies,r=a.public.apiBase;try{if(f){const s=await $fetch(`${r}/currency-prices/featured`);s.success&&(this.featuredCurrencies=s.data,this.featuredLastUpdated=s.last_updated,this.externalCurrencies=s.data,this.externalLastUpdated=s.last_updated)}else{const[s,u]=await Promise.all([$fetch(`${r}/currency-prices/internal`),$fetch(`${r}/currency-prices/external`)]);s.success&&(this.internalCurrencies=s.data,this.internalLastUpdated=s.last_updated),u.success&&(this.externalCurrencies=u.data,this.externalLastUpdated=u.last_updated)}this.hasFetched=!0}catch(s){this.error="فشل في تحميل أسعار العملات",console.error("Currency fetch error:",s)}finally{this.loading=!1}},async refreshCurrencies(){await this.fetchCurrencies(!0)}},getters:{lastUpdated:d=>_().public.useFeaturedCurrencies?d.featuredLastUpdated:d.externalLastUpdated||d.internalLastUpdated}}),I={class:"live-pricing"},R=["title"],P={key:0,class:"loading-state"},E={key:1,class:"tables-container"},M={class:"table-section"},T={class:"currency-table"},j={class:"currency-col"},z={class:"currency-flag"},A={class:"currency-name"},N={class:"buy-col"},V={class:"rate buy"},q={class:"sell-col"},G={class:"rate sell"},H={class:"table-section"},J={class:"currency-table"},K={class:"currency-col"},O={class:"currency-flag"},Q={class:"currency-name"},W={class:"buy-col"},X={class:"rate buy"},Y={class:"sell-col"},Z={class:"rate sell"},ee={class:"live-footer"},se={class:"update-info"},te=L({__name:"live-pricing",setup(d){U({title:"أسعار العملات المباشرة | شركة الرحالة للصرافة"});const a=D(),f=p(!1);let r=null;const s=p(!0);function u(){s.value=!s.value,document.documentElement.classList.toggle("light-theme",!s.value)}const v=y(()=>a.internalCurrencies.length>0||a.externalCurrencies.length>0),C=y(()=>{const h=a.internalLastUpdated,t=a.externalLastUpdated;return h||t||"جاري التحميل..."});async function b(){f.value=!0,await a.refreshCurrencies(),setTimeout(()=>{f.value=!1},1e3)}return k(async()=>{await a.fetchCurrencies(),r=F(()=>{b()},6e4)}),w(()=>{r&&clearInterval(r)}),(h,t)=>(o(),c("div",I,[e("button",{class:"theme-switcher",onClick:u,title:i(s)?"الوضع الفاتح":"الوضع الداكن"},[e("i",{class:B(i(s)?"fas fa-sun":"fas fa-moon")},null,2)],8,R),t[6]||(t[6]=e("div",{class:"live-header"},[e("div",{class:"logo-container"},[e("img",{src:$,alt:"الرحالة للصرافة",class:"logo"}),e("h1",{class:"company-name"},"شركة الرحالة للصرافة والخدمات المالية")])],-1)),i(a).loading&&!i(v)?(o(),c("div",P,[...t[0]||(t[0]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),e("span",null,"جاري تحميل الأسعار...",-1)])])):(o(),c("div",E,[e("div",M,[t[2]||(t[2]=e("div",{class:"table-header"},[e("i",{class:"fas fa-exchange-alt"}),e("h2",null,"البيع والشراء")],-1)),e("table",T,[t[1]||(t[1]=e("thead",null,[e("tr",null,[e("th",{class:"currency-col"},"العملة"),e("th",{class:"buy-col"},"سعر الشراء"),e("th",{class:"sell-col"},"سعر البيع")])],-1)),e("tbody",null,[(o(!0),c(g,null,m(i(a).internalCurrencies,n=>(o(),c("tr",{key:"int-"+n.id},[e("td",j,[e("span",z,l(n.flag),1),e("span",A,l(n.currency_name),1)]),e("td",N,[e("span",V,l(n.formatted_price_buy_price),1)]),e("td",q,[e("span",G,l(n.formatted_price_sale_price),1)])]))),128))])])]),e("div",H,[t[4]||(t[4]=e("div",{class:"table-header"},[e("i",{class:"fas fa-globe"}),e("h2",null,"الحوالات الخارجية")],-1)),e("table",J,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",{class:"currency-col"},"العملة"),e("th",{class:"buy-col"},"سعر الشراء"),e("th",{class:"sell-col"},"سعر البيع")])],-1)),e("tbody",null,[(o(!0),c(g,null,m(i(a).externalCurrencies,n=>(o(),c("tr",{key:"ext-"+n.id},[e("td",K,[e("span",O,l(n.flag),1),e("span",Q,l(n.currency_name),1)]),e("td",W,[e("span",X,l(n.formatted_price_buy_price),1)]),e("td",Y,[e("span",Z,l(n.formatted_price_sale_price),1)])]))),128))])])])])),e("div",ee,[e("div",se,[t[5]||(t[5]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,"آخر تحديث: "+l(i(C)),1)])])]))}}),ne=S(te,[["__scopeId","data-v-238489ee"]]);export{ne as default};
