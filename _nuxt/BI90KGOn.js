import{g as R,y as z,x as W,k as $,l as f,c as i,a as t,q as b,e as A,m as J,s as v,d as p,v as y,j as e,b as B,w as M,G as H,n as w,F,t as x,r as Q,i as X,o as r,E as Y,_ as Z}from"./DCjuOhth.js";import{_ as ss}from"./GBl3w-y-.js";import{u as ts}from"./CHw0qKrg.js";const es={class:"booking-page"},os={class:"container"},as={class:"form-card"},ls={class:"form-section"},ns={class:"form-row"},is={class:"form-group"},rs={class:"form-group"},ds={class:"form-row"},ps={class:"form-group"},us={class:"form-group"},fs={class:"form-row"},cs={class:"form-group"},vs={class:"form-group"},ms={class:"form-section"},bs={class:"file-grid"},ys={class:"form-group"},_s={for:"passport_photo",class:"file-label"},gs={key:1,class:"pdf-preview"},ks=["src"],hs={class:"form-group"},ws={for:"voucher_photo",class:"file-label"},qs={key:1,class:"pdf-preview"},Cs=["src"],Fs={class:"form-group"},xs={for:"national_id_photo",class:"file-label"},Vs={key:1,class:"pdf-preview"},Ds=["src"],Ps={class:"submit-wrapper"},Ss=["disabled"],$s={key:0,class:"bk-modal-overlay"},Bs={class:"bk-modal"},Ms={class:"bk-modal-body"},Us={class:"bk-otp-wrapper"},Os=["onUpdate:modelValue","onInput","onKeydown"],Es={key:0,class:"bk-modal-error"},Is={class:"bk-modal-actions"},Ns=["disabled"],Ts={key:1,class:"modal-overlay show"},js={class:"modal"},Gs={class:"modal-body success-body"},Ks={class:"tracking-code-display"},Ls={class:"success-actions"},Rs=R({__name:"index",setup(zs){z({title:"حجز بطاقة أغراض شخصية | شركة الرحالة",description:"خدمة حجز بطاقات الأغراض الشخصية للمواطنين عبر شركة الرحالة للصرافة"});const{success:N,error:q}=ts(),U=W().public.apiBase,l=$({name:"",phone:"",national_id:"",payment_type:"",account_number:"",booking_amount:""}),d=$({passport:null,voucher:null,national_id:null}),n=$({passport:"",voucher:"",national_id:""}),_=f(!1),O=f(""),C=f(!1),m=f(["","","",""]),V=f([]),g=f(""),k=f(!1),E=f(!1),I=f(""),D=(o,s)=>{const u=o.target.files?.[0];if(u&&(u.type.startsWith("image/")||u.type==="application/pdf")){if(u.size>10*1024*1024){q("حجم الملف يجب أن يكون أقل من 10MB");return}if(d[s]=u,u.type.startsWith("image/")){const a=new FileReader;a.onload=c=>{n[s]=c.target?.result},a.readAsDataURL(u)}else n[s]="pdf"}},P=o=>d[o]?.type==="application/pdf",S=o=>{d[o]=null,n[o]="";const s=document.getElementById(`${o}_photo`);s&&(s.value="")},T=async()=>{if(!d.passport||!d.voucher||!d.national_id){q("يرجى رفع جميع الصور المطلوبة");return}_.value=!0;try{const o=new FormData;o.append("name",l.name),o.append("phone",l.phone),o.append("national_id",l.national_id),o.append("payment_type",l.payment_type.toString()),o.append("account_number",l.account_number),o.append("booking_amount",l.booking_amount),d.passport&&o.append("passport_photo",d.passport),d.voucher&&o.append("voucher_photo",d.voucher),d.national_id&&o.append("national_id_photo",d.national_id);const s=await $fetch(`${U}/booking-cards/store`,{method:"POST",body:o});s.success&&(O.value=s.token,C.value=!0)}catch(o){if(console.error("Step 1 failed:",o.data||o),o.data?.errors){const s=Object.values(o.data.errors).flat().join(`
`);q(s)}else q(o.data?.message||"حدث خطأ أثناء إرسال البيانات")}finally{_.value=!1}},j=o=>{m.value[o]&&o<3&&V.value[o+1]?.focus()},G=(o,s)=>{!m.value[o]&&o>0&&V.value[o-1]?.focus()},K=async()=>{const o=m.value.join("");if(o.length!==4){g.value="يرجى إدخال الرمز كاملاً";return}k.value=!0,g.value="";try{const s=await $fetch(`${U}/booking-cards/verify-otp`,{method:"POST",body:{token:O.value,otp:o}});s.success&&(C.value=!1,I.value=s.tracking_code,E.value=!0,N("تم تنفيذ الحجز بنجاح"),L())}catch(s){console.error("Verification failed:",s.data||s),g.value=s.data?.message||"رمز التحقق غير صحيح"}finally{k.value=!1}},L=()=>{l.name="",l.phone="",l.national_id="",l.payment_type="",d.passport=null,d.voucher=null,d.national_id=null,n.passport="",n.voucher="",n.national_id="",m.value=["","","",""],["passport_photo","voucher_photo","national_id_photo"].forEach(s=>{const h=document.getElementById(s);h&&(h.value="")})};return(o,s)=>{const h=X,u=ss;return r(),i("div",es,[t("div",os,[s[40]||(s[40]=A('<div class="page-header" data-v-d3469a29><div class="header-badge" data-v-d3469a29><i class="fas fa-id-card" data-v-d3469a29></i><span data-v-d3469a29>شركة الرحالة للصرافة والخدمات المالية</span></div><h1 class="page-title" data-v-d3469a29>تقديم طلب للموافقه علي <span class="gradient-text" data-v-d3469a29>شحن بطاقة الأغراض الشخصية</span></h1><p class="page-subtitle" data-v-d3469a29>يرجى ملء البيانات بدقة ورفع المستندات المطلوبة (صور أو PDF بحد أقصى 10 ميجا)</p></div>',1)),t("div",as,[t("form",{onSubmit:J(T,["prevent"])},[t("div",ls,[s[21]||(s[21]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-user-edit"}),t("span",null,"المعلومات الشخصية")],-1)),t("div",ns,[t("div",is,[s[13]||(s[13]=t("label",{class:"label"},[p("الإسم بالكامل "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>e(l).name=a),type:"text",class:"input",placeholder:"أدخل اسمك كما هو في الجواز",required:""},null,512),[[y,e(l).name]])]),t("div",rs,[s[14]||(s[14]=t("label",{class:"label"},[p("الرقم الوطني (12 رقم) "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>e(l).national_id=a),type:"text",class:"input",maxlength:"12",pattern:"[0-9]{12}",placeholder:"مثال: 119900123456",required:""},null,512),[[y,e(l).national_id]])])]),t("div",ds,[t("div",ps,[s[16]||(s[16]=t("label",{class:"label"},[p("رقم الهاتف "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>e(l).phone=a),type:"tel",class:"input",placeholder:"مثال: 0912345678",required:""},null,512),[[y,e(l).phone]]),B(h,null,{default:M(()=>[...s[15]||(s[15]=[t("span",{class:"hint"},"يدعم الأرقام الليبية والمصرية - سيتم إرسال الرمز عبر الواتساب",-1)])]),_:1})]),t("div",us,[s[18]||(s[18]=t("label",{class:"label"},[p("نوع الدفع "),t("span",{class:"required"},"*")],-1)),v(t("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>e(l).payment_type=a),class:"input select-input",required:""},[...s[17]||(s[17]=[t("option",{value:"",disabled:"",selected:""},"اختر نوع الدفع",-1),t("option",{value:0},"نقدي",-1),t("option",{value:1},"مصرف",-1)])],512),[[H,e(l).payment_type]])])]),t("div",fs,[t("div",cs,[s[19]||(s[19]=t("label",{class:"label"},[p("رقم الحساب "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>e(l).account_number=a),type:"text",class:"input",placeholder:"أدخل رقم الحساب الجاري",required:""},null,512),[[y,e(l).account_number]])]),t("div",vs,[s[20]||(s[20]=t("label",{class:"label"},[p("قيمة الحجز بالدولار "),t("span",{class:"required"},"*")],-1)),v(t("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>e(l).booking_amount=a),type:"number",step:"0.01",class:"input",placeholder:"مثال: 100",required:""},null,512),[[y,e(l).booking_amount]])])])]),s[39]||(s[39]=t("hr",{class:"divider"},null,-1)),t("div",ms,[s[37]||(s[37]=t("h3",{class:"section-title"},[t("i",{class:"fas fa-file-invoice"}),t("span",null,"المستندات المطلوبة")],-1)),t("div",bs,[t("div",ys,[s[26]||(s[26]=t("label",{class:"label"},[p("صورة جواز السفر "),t("span",{class:"required"},"*")],-1)),t("div",{class:w(["file-wrapper",{"has-file":e(n).passport}])},[t("input",{type:"file",id:"passport_photo",class:"file-input",onChange:s[6]||(s[6]=a=>D(a,"passport")),accept:"image/*,.pdf",required:""},null,32),t("label",_s,[e(n).passport?P("passport")?(r(),i("div",gs,[...s[24]||(s[24]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(r(),i("img",{key:2,src:e(n).passport,class:"preview-img"},null,8,ks)):(r(),i(F,{key:0},[s[22]||(s[22]=t("i",{class:"fas fa-file-upload"},null,-1)),s[23]||(s[23]=t("span",null,"رفع الجواز (صورة أو PDF)",-1))],64))]),e(n).passport?(r(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[7]||(s[7]=a=>S("passport"))},[...s[25]||(s[25]=[t("i",{class:"fas fa-times"},null,-1)])])):b("",!0)],2)]),t("div",hs,[s[31]||(s[31]=t("label",{class:"label"},[p("صورة القسيمة "),t("span",{class:"required"},"*")],-1)),t("div",{class:w(["file-wrapper",{"has-file":e(n).voucher}])},[t("input",{type:"file",id:"voucher_photo",class:"file-input",onChange:s[8]||(s[8]=a=>D(a,"voucher")),accept:"image/*,.pdf",required:""},null,32),t("label",ws,[e(n).voucher?P("voucher")?(r(),i("div",qs,[...s[29]||(s[29]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(r(),i("img",{key:2,src:e(n).voucher,class:"preview-img"},null,8,Cs)):(r(),i(F,{key:0},[s[27]||(s[27]=t("i",{class:"fas fa-receipt"},null,-1)),s[28]||(s[28]=t("span",null,"رفع القسيمة (صورة أو PDF)",-1))],64))]),e(n).voucher?(r(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[9]||(s[9]=a=>S("voucher"))},[...s[30]||(s[30]=[t("i",{class:"fas fa-times"},null,-1)])])):b("",!0)],2)]),t("div",Fs,[s[36]||(s[36]=t("label",{class:"label"},[p("صورة الرقم الوطني "),t("span",{class:"required"},"*")],-1)),t("div",{class:w(["file-wrapper",{"has-file":e(n).national_id}])},[t("input",{type:"file",id:"national_id_photo",class:"file-input",onChange:s[10]||(s[10]=a=>D(a,"national_id")),accept:"image/*,.pdf",required:""},null,32),t("label",xs,[e(n).national_id?P("national_id")?(r(),i("div",Vs,[...s[34]||(s[34]=[t("i",{class:"fas fa-file-pdf"},null,-1),t("span",null,"PDF جاهز",-1)])])):(r(),i("img",{key:2,src:e(n).national_id,class:"preview-img"},null,8,Ds)):(r(),i(F,{key:0},[s[32]||(s[32]=t("i",{class:"fas fa-address-card"},null,-1)),s[33]||(s[33]=t("span",null,"رفع الرقم الوطني (صورة أو PDF)",-1))],64))]),e(n).national_id?(r(),i("button",{key:0,type:"button",class:"remove-btn",onClick:s[11]||(s[11]=a=>S("national_id"))},[...s[35]||(s[35]=[t("i",{class:"fas fa-times"},null,-1)])])):b("",!0)],2)])]),s[38]||(s[38]=t("p",{class:"hint files-hint"},"الصيغ المسموحة: JPG, PNG, PDF - الحد الأقصى لكل ملف: 10MB",-1))]),t("div",Ps,[t("button",{type:"submit",class:"submit-btn",disabled:e(_)},[t("span",null,x(e(_)?"جاري المعالجة...":"التالي (التحقق من الهاتف)"),1),t("i",{class:w(e(_)?"fas fa-spinner fa-spin":"fas fa-arrow-left")},null,2)],8,Ss)])],32)])]),e(C)?(r(),i("div",$s,[t("div",Bs,[s[43]||(s[43]=t("div",{class:"bk-modal-header"},[t("i",{class:"fas fa-shield-halved"}),t("h3",null,"التحقق من رقم الهاتف")],-1)),t("div",Ms,[s[42]||(s[42]=t("p",null,[p("تم إرسال رمز التحقق إلى رقم هاتفك عبر الواتساب"),t("br"),p("أدخل الرمز المكون من 4 أرقام")],-1)),t("div",Us,[(r(),i(F,null,Q(4,a=>v(t("input",{key:a,ref_for:!0,ref:c=>e(V)[a-1]=c,"onUpdate:modelValue":c=>e(m)[a-1]=c,type:"text",class:"bk-otp-input",maxlength:"1",onInput:c=>j(a-1),onKeydown:Y(c=>G(a-1),["backspace"]),autocomplete:"one-time-code",inputmode:"numeric"},null,40,Os),[[y,e(m)[a-1]]])),64))]),e(g)?(r(),i("div",Es,x(e(g)),1)):b("",!0),t("div",Is,[t("button",{type:"button",class:"submit-btn secondary",onClick:s[12]||(s[12]=a=>C.value=!1)},[...s[41]||(s[41]=[t("span",null,"إغلاق",-1)])]),t("button",{type:"button",class:"submit-btn",onClick:K,disabled:e(k)},[t("i",{class:w(e(k)?"fas fa-spinner fa-spin":"fas fa-check")},null,2),t("span",null,x(e(k)?"جاري التحقق...":"تأكيد الحجز"),1)],8,Ns)])])])])):b("",!0),e(E)?(r(),i("div",Ts,[t("div",js,[t("div",Gs,[s[46]||(s[46]=t("div",{class:"success-icon"},[t("i",{class:"fas fa-check-circle"})],-1)),s[47]||(s[47]=t("h2",null,"تم تقديم طلبك بنجاح!",-1)),s[48]||(s[48]=t("p",null,"رقم تتبع الحجز الخاص بك:",-1)),t("div",Ks,x(e(I)),1),s[49]||(s[49]=t("p",{class:"hint"},"احتفظ بهذا الرقم لتتبع حالة حجزك لاحقاً",-1)),t("div",Ls,[B(u,{to:"/",class:"submit-btn secondary"},{default:M(()=>[...s[44]||(s[44]=[t("i",{class:"fas fa-home"},null,-1),t("span",null,"الرئيسية",-1)])]),_:1}),B(u,{to:"/booking-cards/track",class:"submit-btn"},{default:M(()=>[...s[45]||(s[45]=[t("i",{class:"fas fa-search"},null,-1),t("span",null,"تتبع الطلب",-1)])]),_:1})])])])])):b("",!0)])}}}),Qs=Z(Rs,[["__scopeId","data-v-d3469a29"]]);export{Qs as default};
